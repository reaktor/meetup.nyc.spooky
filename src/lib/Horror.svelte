<script lang="ts">
  import type { AuthSession } from "@supabase/supabase-js";
  import Account from "./Account.svelte";
  import Auth from "./Auth.svelte";
  import Rsvp from "./Rsvp.svelte";
  import { supabase } from "../supabaseClient";

  export let session: AuthSession;
  let open = false;

  function toggle() {
    if (!open) {
      open = true;
    }
  }
</script>

<svg
  version="1.1"
  id="_x31_"
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  x="0px"
  y="0px"
  viewBox="0 0 512 512"
  style="enable-background:new 0 0 512 512;"
  xml:space="preserve"
  on:click={toggle}
  class:opened={open}
  class:closed={!open}
>
  <g>
    <g>
      <path
        style="fill:#231815;stroke:#80C272;stroke-miterlimit:10;"
        d="M145.549,34.441
			c-36.314,13.206-93.555,172.797-82.903,218.956c10.652,46.159,42.608,111.255,118.354,132.557
			c75.747,21.305,203.57,15.386,234.344-7.101c30.77-22.487,41.483-127.823,28.462-158.595
			c-13.021-30.774-26.037-99.417-62.73-138.475C344.385,42.725,184.604,20.238,145.549,34.441z"
      />
      <path
        style="fill:#FFFFFF;"
        d="M108.171,144.511c0,0-1.129,7.102,9.045,8.285c10.178,1.183,22.616-5.919,22.616-5.919
			s-2.259-15.385,2.264-15.385c4.521,0,14.697,52.077,35.049,54.443c5.748,0.218,3.689-41.825,7.805-56.379
			c1.046-3.691,1.238-11.083,5.763-8.716c4.523,2.367-1.131,13.019,10.176,14.201c11.305,1.184,31.661,1.185,35.051-3.549
			c3.39-4.734,3.39-18.938,3.39-22.488c0-3.55,2.265,0.001,3.394,13.019c1.131,13.018,10.178,12.902,20.354,12.902
			c10.176,0,27.012,2.236,27.719-4.83c1.617-16.171,5.39-8.624,5.39-8.624s3.129,15.56,5.39,34.497
			c2.264,18.937,0.171,29.646,8.085,29.646c7.913,0,24.395-32.798,25.527-45.816c1.129-13.019,4.119-8.307,4.119-3.572
			c0,4.734,2.739,8.213,15.452,13.454c16.992,7.007,18.687-4.312,18.687-4.312s13.294,22.998,28.387,13.296
			c12.882-8.281-26.825-106.47-92.399-117.122C243.854,30.89,181.667,32.074,152.27,47.46
			c-29.395,15.386-75.755,104.153-84.801,115.988c-9.045,11.835,6.919-7.469,12.572-1.551c5.655,5.917,24.742-0.774,25.873-10.241
			C104.297,141.954,108.171,144.511,108.171,144.511z"
      />
      <path
        style="fill:#FFFFFF;"
        d="M271.849,318.774c-2.255-9.541-10.389-16.514-23.268-16.147
			c-12.884,0.364-10.526,13.506-11.311,20.732c-0.788,7.226-3.009-1.115-5.194-8.257c-2.188-7.141-6.218-9.427-12.164-9.259
			c-5.946,0.168-10.73,6.308-8.374,19.449c2.356,13.138-18.383-18.689-20.26-49.851c-2.221-8.342-9.125-6.945-12.884,0.366
			c-3.758,7.31-12.987,31.584-7.418,53.038c-1.878,3.655-9.704,7.478-11.174-9.287c-1.468-16.768-5.5-19.054-14.52-22.399
			c-9.022-3.346-14.627,8.82-14.627,8.82s-3.312-11.911-14.28-14.002c-10.97-2.089-16.914-1.921-14.524,12.419
			c2.392,14.341,36.316,91.416,180.996,87.303c144.678-4.113,149.512-101.761,146.131-116.072
			c-3.382-14.311-25.869,9.701-32.339,29.106c-3.312-11.913-17.939,5-21.801,8.711c-3.863,3.712-9.911,0.282-9.022-3.345
			c0.889-3.627-1.16-40.788-15.202-46.392c-10.149-8.116-7.007,32.616-21.291,53.432c-1.162-5.97,0.581-14.423-12.334-15.257
			c-12.918-0.834-14.594,10.02-14.457,14.819c-3.381-14.311-15.307-15.174-23.201-13.749
			C271.441,304.377,271.849,318.774,271.849,318.774z"
      />
      <path
        class="lips"
        d="M333.733,3.665c-40.449-0.19-66.278,1.184-106.519,0c-40.241-1.184-80.482-16.569-117.171,26.038
			S67.469,163.448,50.606,214.181c-4.853,14.6-19.918,29.744-15.183,47.498c3.478,13.038,29.589,78.114,75.747,127.824
			c30.665,33.025,78.499,70.459,136.108,33.139c33.318-21.584,107.378,13.656,139.658,0c30.775-13.02,74.384-82.337,90.551-176.121
			C425.745,133.332,399.872,3.974,333.733,3.665z M380.028,330.604c-37.874,10.652-50.861-10.018-97.019-6.468
			c-46.158,3.55-100.154,26.929-119.763,20.392c-28.406-9.469-75.747-62.727-84.032-79.298
			c-5.293-10.584-11.802-15.437-9.206-28.411c4.735-23.671,30.566-94.678,50.687-117.166c18.824-21.04,36.691-37.873,71.014-34.322
			c34.322,3.551,48.524,9.468,127.823-1.183c40.313-5.415,92.317,104.152,115.988,153.861
			C440.13,247.684,417.904,319.952,380.028,330.604z"
      />
      <path
        style="fill:#FFFFFF;"
        d="M119.701,39.001c10.071-18.126,26.951-32.341,49.59-30.185c22.639,2.156,36.653,7.546,24.795,7.546
			c-11.858,0-38.809-2.156-48.511,10.78c-9.702,12.936-28.029,35.575-34.497,34.497C104.609,60.562,114.311,48.704,119.701,39.001z"
      />
      <path
        style="fill:#FFFFFF;"
        d="M149.444,350.554c17.169,8.583,31.263,10.78,44.199,11.858c12.936,1.078,15.092,0,2.156,4.312
			c-12.936,4.312-19.405,11.858-34.497,3.234S142.976,347.319,149.444,350.554z"
      />
      <path
        style="fill:#FFFFFF;"
        d="M242.635,22.572c9.146,3.049,15.092,3.234,15.092-4.312c0-7.546,2.156-5.39,7.546,1.078
			c6.468-5.39,0-9.702,6.468-5.39c6.468,4.312,17.249,21.561,9.702,20.483c-7.546-1.078-9.702-9.702-14.014-8.624
			c-4.312,1.078,1.078,0-4.312,1.078c-5.39,1.078-10.78,3.234-19.405,2.156C235.089,27.962,239.401,21.494,242.635,22.572z"
      />
      <path
        style="fill:#FFFFFF;"
        d="M266.988,391.26c-7.142-5.714,3.234-9.702,9.702-5.39c6.468,4.312,20.483,2.156,19.405-7.546
			c-1.078-9.702,2.156-7.546,6.468-1.078c4.312,6.468,6.468,10.78,12.936,9.702s6.468-14.014,10.78-8.624
			c4.312,5.39,7.546,9.702,17.249,9.702s14.014-14.014,16.171-7.546c2.156,6.468-4.312,17.249-17.249,16.171
			c-12.936-1.078-10.78-9.702-19.405-4.312s-10.78,8.624-16.171,4.312c-5.39-4.312,2.156-4.312-5.39-4.312
			c-7.546,0-14.014-2.156-21.561,0C272.378,394.494,272.378,395.572,266.988,391.26z"
      />
    </g>
    <path
      class="lips"
      d="M243.277,411.085c-38.807,9.702-19.413,56.716-43.13,57.794
		c-19.649,0.893-11.858-20.483-15.082-18.986c-5.146,2.39,19.394,62.107-6.479,62.107c-25.873,0,14.014-78.697-38.796-107.383
		C99.401,382.679,243.277,411.085,243.277,411.085z"
    />
    <path
      style="fill:#FFFFFF;"
      d="M177.869,501.216c-5.39-5.39-1.078-17.249,2.156-11.858S177.869,501.216,177.869,501.216z"
    />
    {#if !open}
      <text
        x="160"
        y="250"
        font-size="69px"
        fill="#ff6600"
        font-family="cursive">RSVP</text
      >
    {/if}
  </g>
</svg>

{#if open}
  <div class="rsvpopen fadein">
    <button on:click={() => (open = false)} class="close" title="close"
      >&times;</button
    >

    {#if !session}
      <Auth />
    {:else}
      <button
        type="button"
        class="button block signout"
        on:click={() => supabase.auth.signOut()}
      >
        Sign Out
      </button>
      <Account {session} />
      <Rsvp {session} />
    {/if}
  </div>
{:else}
  <div class="rsvpStatus fadein">
    <Rsvp {session} showStatusOnly={true} />
  </div>
{/if}

<style>
  .rsvpStatus {
    position: fixed;
    bottom: 104px;
    right: 84px;
    background: rgba(0, 0, 0, 0.69);
  }
  svg {
    position: fixed;
    bottom: 10px;
    right: 0;
    height: 250px;
    width: 250px;
    transition-property: all;
    animation-timing-function: ease-in-out;
    transition-duration: 1s;
  }
  svg.closed .lips {
    fill: #e62c41;
  }
  svg.opened .lips {
    fill: #ff11ff;
  }
  svg.closed:hover .lips {
    fill: #ff11ff;
  }
  svg.closed:hover text {
    fill: #e62c41;
    text-decoration: underline;
  }
  svg.closed:hover {
    cursor: pointer;
    transform: scale(1, 1.05);
  }

  svg.opened {
    width: unset;
    height: unset;
    transform: scale(1.4) translate(0, 20%);
  }
  @media (max-width: 900px) {
    svg.opened {
      transform: scale(2, 2.5);
    }
  }

  .rsvpopen {
    z-index: 2;
    background: rgba(0, 0, 0, 0.69);
    padding: 2em;
    padding-left: 4em;
    border-radius: 10px;
  }

  .close {
    position: relative;
    top: -2em;
    right: -2em;
    float: right;
  }

  .signout {
    position: relative;
    top: -2em;
    left: -4em;
    float: right;
  }

  .fadein {
    opacity: 1;
    animation-name: fadeInOpacity;
    animation-iteration-count: 1;
    animation-timing-function: ease-in;
    animation-duration: 0.5s;
  }

  @keyframes fadeInOpacity {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
</style>
